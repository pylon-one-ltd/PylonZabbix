zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: bf8846d58f414cd488b718c930236658
      name: 'Templates/Pylon Templates'
  templates:
    - uuid: ca5ab9e173764cd99c17665ae37f2d66
      template: 'Pylon Fortigate Template'
      name: 'Pylon Fortigate Template'
      templates:
        - name: 'ICMP Ping'
        - name: 'Interfaces SNMP'
      groups:
        - name: 'Templates/Pylon Templates'
      items:
        - uuid: f3d227db31b54687ad9b01743d3d89d9
          name: 'Fortigate HA Config Sync'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.12356.101.13.1.5.0
          key: fgHaAutoSync
          history: 90d
          valuemap:
            name: 'Fortigate HA Auto Sync'
          tags:
            - tag: component
              value: ha
            - tag: component
              value: health
          triggers:
            - uuid: 78c41b7393d948ec98bb03cabc8533d7
              expression: 'last(/Pylon Fortigate Template/fgHaAutoSync)<>2'
              name: 'HA Config Sync not Enabled'
              opdata: 'Current State: {#ITEM.LASTVALUE1}'
              priority: HIGH
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: component
                  value: ha
                - tag: component
                  value: health
        - uuid: 50962fe939274e389b9511607e251915
          name: 'Fortigate HA Status'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.12356.101.13.1.1.0
          key: fgHaSystemMode
          history: 90d
          valuemap:
            name: 'Fortigate HA Status'
          tags:
            - tag: component
              value: ha
            - tag: component
              value: health
          triggers:
            - uuid: a3232bf6752d4953896c6d86df61ea3d
              expression: 'last(/Pylon Fortigate Template/fgHaSystemMode,#1)<>last(/Pylon Fortigate Template/fgHaSystemMode,#2)'
              name: 'HA Status has changed'
              opdata: 'Current State: {#ITEM.LASTVALUE1}, Last State: {#ITEM.LASTVALUE2}'
              priority: AVERAGE
              description: 'The HA state of the cluster has changed from it''s previous value. If this is expected, you may close this issue'
              manual_close: 'YES'
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: component
                  value: ha
                - tag: component
                  value: health
        - uuid: d482c9a136254c27a8ce3d0213d38de0
          name: 'Fortigate Software Version'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.12356.101.4.1.1.0
          key: fgSysVersion
          delay: 1h
          history: 2w
          value_type: TEXT
          trends: '0'
          inventory_link: OS
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 2fcee5f36f52473982b71d1af8c68a00
              expression: 'last(/Pylon Fortigate Template/fgSysVersion,#1)<>last(/Pylon Fortigate Template/fgSysVersion,#2) and length(last(/Pylon Fortigate Template/fgSysVersion))<>0'
              name: 'System software version changed'
              opdata: 'Current Version: {#ITEM.LASTVALUE1}, Previous Version: {#ITEM.LASTVALUE2}'
              priority: INFO
              description: 'The software version of the FortiGate appliance has changed'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: system
        - uuid: ad0348a1aa4d4433b2944eadb22e402a
          name: 'System contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: 'system.contact[sysContact.0]'
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            The textual identification of the contact person for this managed node, together with information on how to contact this person.  If no contact information is known, the value is the zero-length string.
          inventory_link: CONTACT
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: c0bf4fc5b9fe41a7b08d4d501a276a75
          name: 'System description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: 'system.descr[sysDescr.0]'
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            A textual description of the entity. This value should
            include the full name and version identification of the system's hardware type, software operating-system, and
            networking software.
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: f63cc9e6aacd4584858c390850304515
          name: 'Uptime (hardware)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.1.1.0
          key: 'system.hw.uptime[hrSystemUptime.0]'
          history: 2w
          trends: '0'
          units: uptime
          description: |
            MIB: HOST-RESOURCES-MIB
            The amount of time since this host was last initialized. Note that this is different from sysUpTime in the SNMPv2-MIB [RFC1907] because sysUpTime is the uptime of the network management portion of the system.
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
              error_handler: CUSTOM_VALUE
              error_handler_params: '0'
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: component
              value: system
        - uuid: b3a81713df774762bb5c96c9b1bd05b3
          name: 'System location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: 'system.location[sysLocation.0]'
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            The physical location of this node (e.g., `telephone closet, 3rd floor').  If the location is unknown, the value is the zero-length string.
          inventory_link: LOCATION
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 4df50ba8eb9d487fa20b833730e1302a
          name: 'Uptime (network)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          history: 2w
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: component
              value: system
        - uuid: 3126f7b75e9b4f308b6ccb611249fb5d
          name: 'SNMP agent availability'
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 2w
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 2c75b72fb4ba4f1ca0b9863f7ce3bcbd
              expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: 'No SNMP data collection'
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              dependencies:
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/Pylon Fortigate Template/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: 7bf09fe3d2d4465ea346ac84348764cf
          name: 'DHCP Server Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.12356.101.23.2.1.1.2.1]'
          key: fgDhcp
          delay: 1h
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'FORTINET-FORTIGATE-MIB::fgDhcpTables'
          item_prototypes:
            - uuid: 93536020e04347939c34089933287946
              name: 'DHCP Pool {#SNMPINDEX} Usage'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.12356.101.23.2.1.1.2.1.{#SNMPINDEX}'
              key: 'fgDhcpLeaseUsage.[{#SNMPINDEX}]'
              history: 90d
              units: '%'
              tags:
                - tag: component
                  value: dhcp
              trigger_prototypes:
                - uuid: 5dc9724a0fa447d5b962864caee93f62
                  expression: 'last(/Pylon Fortigate Template/fgDhcpLeaseUsage.[{#SNMPINDEX}])>80'
                  name: 'DHCP Pool {#SNMPINDEX} Near Exhaustion'
                  opdata: 'Pool Usage: {ITEM.LASTVALUE1}%'
                  priority: WARNING
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: dhcp
        - uuid: f2da147698fb422a9902eb363730bf89
          name: 'HA Cluster Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.12356.101.13.2.1.1.11]'
          key: fgHighAvailability
          delay: 1h
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'FORTINET-FORTIGATE-MIB::fgHaTables'
          item_prototypes:
            - uuid: 970d4aa287ac4ba69c27f62cfb28cfa9
              name: 'Unit {#SNMPINDEX} Network Usage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.5.{#SNMPINDEX}'
              key: 'fgHaStatsNetUsage.[{#SNMPINDEX}]'
              history: 90d
              units: bps
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '1000'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sessions
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
            - uuid: 4bd9aed1cf944d19b6d89a97bf506967
              name: 'Unit {#SNMPINDEX} Session Count'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.6.{#SNMPINDEX}'
              key: 'fgHaStatsSesCount.[{#SNMPINDEX}]'
              history: 90d
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sessions
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
            - uuid: 6b84e90bed4f4e1e9e6b15bc55bd9f7b
              name: 'Unit {#SNMPINDEX} Sync Status'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.12.{#SNMPINDEX}'
              key: 'fgHaStatsSyncStatus.[{#SNMPINDEX}]'
              delay: 5m
              history: 2w
              trends: '0'
              valuemap:
                name: 'Fortigate HA Sync State'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sessions
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 13a5ea0d0b25440b996c2327048f2fd8
                  expression: 'last(/Pylon Fortigate Template/fgHaStatsSyncStatus.[{#SNMPINDEX}])<>1'
                  name: 'Unit {#SNMPINDEX} HA Sync State Unsyncronized'
                  priority: HIGH
                  description: 'The HA configuration is not synchronised on this member'
                  tags:
                    - tag: component
                      value: ha
                    - tag: component
                      value: health
            - uuid: 2e36e3f772584bbb9e418ec3e9835a32
              name: 'Unit {#SNMPINDEX} CPU Usage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.3.{#SNMPINDEX}'
              key: 'fgStatsCpuUsage.[{#SNMPINDEX}]'
              history: 90d
              units: '%'
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: health
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 6defbc688c444979bc06abe680b352a8
                  expression: 'last(/Pylon Fortigate Template/fgStatsCpuUsage.[{#SNMPINDEX}])>{$FW.CPU.CRIT}'
                  name: 'Unit {#SNMPINDEX} CPU Usage Critical'
                  opdata: 'Percentage: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'CPU usage is above critical threshold'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: health
                - uuid: 7fca09989d5c4952af2d8c7136a9c00e
                  expression: 'last(/Pylon Fortigate Template/fgStatsCpuUsage.[{#SNMPINDEX}])>{$FW.CPU.WARN}'
                  name: 'Unit {#SNMPINDEX} CPU Usage Warning'
                  opdata: 'Percentage: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'CPU usage is above warning threshold'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'Unit {#SNMPINDEX} CPU Usage Critical'
                      expression: 'last(/Pylon Fortigate Template/fgStatsCpuUsage.[{#SNMPINDEX}])>{$FW.CPU.CRIT}'
                  tags:
                    - tag: component
                      value: health
            - uuid: 700d5761c6454814bb2345fcf7e2ebb5
              name: 'Unit {#SNMPINDEX} Hostname'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.11.{#SNMPINDEX}'
              key: 'fgStatsHostName.[{#SNMPINDEX}]'
              delay: 1d
              history: 2w
              value_type: CHAR
              trends: '0'
              tags:
                - tag: component
                  value: system
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 99174f048acb4a8d8ce6f9304c4050c0
                  expression: 'last(/Pylon Fortigate Template/fgStatsHostName.[{#SNMPINDEX}],#1)<>last(/Pylon Fortigate Template/fgStatsHostName.[{#SNMPINDEX}],#2) and length(last(/Pylon Fortigate Template/fgStatsHostName.[{#SNMPINDEX}]))>0'
                  name: 'Unit {#SNMPINDEX} Hostname Changed'
                  opdata: 'System name has changed (new name: {ITEM.VALUE})'
                  priority: INFO
                  description: 'System name has changed. Ack to close.'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: system
            - uuid: 37288123208e42d58a659dce8b738bfe
              name: 'Unit {#SNMPINDEX} Memory Usage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.4.{#SNMPINDEX}'
              key: 'fgStatsMemUsage.[{#SNMPINDEX}]'
              history: 90d
              units: '%'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: memory
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: e437c10e9fef442ea0de831ff6e4f9de
                  expression: 'last(/Pylon Fortigate Template/fgStatsMemUsage.[{#SNMPINDEX}])>{$FW.MEM.CRIT}'
                  name: 'Unit {#SNMPINDEX} Memory Usage Critical'
                  opdata: 'Percentage: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Memory usage is above critical threshold'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: health
                - uuid: ca1af100f7b74e09bac71ec176ae4ca3
                  expression: 'last(/Pylon Fortigate Template/fgStatsMemUsage.[{#SNMPINDEX}])>{$FW.MEM.WARN}'
                  name: 'Unit {#SNMPINDEX} Memory Usage Warning'
                  opdata: 'Percentage: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'Memory usage is above warning threshold'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'Unit {#SNMPINDEX} Memory Usage Critical'
                      expression: 'last(/Pylon Fortigate Template/fgStatsMemUsage.[{#SNMPINDEX}])>{$FW.MEM.CRIT}'
                  tags:
                    - tag: component
                      value: health
            - uuid: 2346c249c750488ca45b058f31b975eb
              name: 'Unit {#SNMPINDEX} Serial Number'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.13.2.1.1.2.{#SNMPINDEX}'
              key: 'fgStatsSerial.[{#SNMPINDEX}]'
              delay: 1d
              history: 2w
              value_type: CHAR
              trends: '0'
              tags:
                - tag: component
                  value: system
                - tag: ha-hostname
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 16960083c02143d4b89cf11f8d8f7eef
                  expression: 'last(/Pylon Fortigate Template/fgStatsSerial.[{#SNMPINDEX}],#1)<>last(/Pylon Fortigate Template/fgStatsSerial.[{#SNMPINDEX}],#2) and length(last(/Pylon Fortigate Template/fgStatsSerial.[{#SNMPINDEX}]))>0'
                  name: 'Unit {#SNMPINDEX} Serial Changed'
                  opdata: 'System name has changed (new name: {ITEM.VALUE})'
                  priority: INFO
                  description: 'Serial number has changed. Ack to close.'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: system
        - uuid: 5c11fcf926cf4df280f009b9e8f99f9e
          name: 'Hardware Sensor Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.12356.101.4.3.2.1.2]'
          key: fgHwSensorEntIndex
          delay: 1h
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'Discover Fortigate Hardware Sensors'
          item_prototypes:
            - uuid: de0de8e7e6064f2fa234cb1683d75f4b
              name: 'Sensor {#SNMPVALUE} Alarm Status'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.4.3.2.1.4.{#SNMPINDEX}'
              key: 'fgHwSensorEntAlarmStatus.[{#SNMPINDEX}]'
              history: 90d
              valuemap:
                name: 'Fortigate Sensor Alarm State'
              tags:
                - tag: component
                  value: hardware
                - tag: component
                  value: health
                - tag: sensor
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 37856fc9de9c4a4785514eb2fa29089a
                  expression: 'last(/Pylon Fortigate Template/fgHwSensorEntAlarmStatus.[{#SNMPINDEX}])<>0'
                  name: 'Sensor {#SNMPVALUE} In Alarm State'
                  priority: WARNING
                  description: 'Sensor is in alarm state'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: hardware
                    - tag: component
                      value: health
            - uuid: 69a4d115df8b4fd1b372a9f3351ae8b8
              name: 'Sensor {#SNMPVALUE} Value'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.4.3.2.1.3.{#SNMPINDEX}'
              key: 'fgHwSensorEntValue.[{#SNMPINDEX}]'
              history: 90d
              value_type: TEXT
              trends: '0'
              tags:
                - tag: component
                  value: hardware
                - tag: component
                  value: health
                - tag: sensor
                  value: '{#SNMPVALUE}'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var jsonData = JSON.parse(value);
                  jsonData.forEach(function(value) {
                   value["{#SNMPVALUE}"] = value["{#SNMPVALUE}"].trim();
                  });
                  return JSON.stringify(jsonData);
        - uuid: d7dd55db020e4a4081097a8a066b9b77
          name: 'Virtual Domain Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.12356.101.3.2.1.1.2]'
          key: fgVirtualDomain
          delay: 1h
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'Discover Fortigate VDOMs'
          item_prototypes:
            - uuid: a7a274297afb46c5a44584ec32350b0e
              name: 'VDOM {#SNMPVALUE} CPU Usage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.3.2.1.{#SNMPINDEX}.5.1'
              key: 'fgVdEntCpuUsage.[{#SNMPINDEX}]'
              history: 90d
              units: '%'
              tags:
                - tag: component
                  value: health
                - tag: vdom
                  value: '{#SNMPVALUE}'
            - uuid: 634221c2730b441094ca7a46e6aa0f2b
              name: 'VDOM {#SNMPVALUE} Memory Usage'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.3.2.1.{#SNMPINDEX}.6.1'
              key: 'fgVdEntMemUsage.[{#SNMPINDEX}]'
              history: 90d
              units: '%'
              tags:
                - tag: component
                  value: health
                - tag: vdom
                  value: '{#SNMPVALUE}'
            - uuid: afbdd2a4e2bf4e00906e3acd3e921188
              name: 'VDOM {#SNMPVALUE} Operation Mode'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.3.2.1.{#SNMPINDEX}.3.1'
              key: 'fgVdEntOpMode.[{#SNMPINDEX}]'
              delay: 1h
              history: 2w
              trends: '0'
              valuemap:
                name: 'Fortigate VDOM Operation Mode'
              tags:
                - tag: component
                  value: health
                - tag: vdom
                  value: '{#SNMPVALUE}'
            - uuid: a1bc2e06f4db4b10b3f5d1ecd825d5c7
              name: 'VDOM {#SNMPVALUE} Session Count'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.3.2.1.{#SNMPINDEX}.6.1'
              key: 'fgVdEntSesCount.[{#SNMPINDEX}]'
              history: 90d
              tags:
                - tag: component
                  value: health
                - tag: vdom
                  value: '{#SNMPVALUE}'
            - uuid: 828a627ce0cc4e87a7feddd73820c570
              name: 'VDOM {#SNMPVALUE} Session Rate'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.3.2.1.{#SNMPINDEX}.7.1'
              key: 'fgVdEntSesRate.[{#SNMPINDEX}]'
              history: 90d
              tags:
                - tag: component
                  value: health
                - tag: vdom
                  value: '{#SNMPVALUE}'
        - uuid: b8302b7507f94071a91b52be2dcff124
          name: 'SDWAN Performance SLA Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.12356.101.4.9.2.1.2,{#SNMPVDOM},.1.3.6.1.4.1.12356.101.4.9.2.1.10,{#SNMPINTF},.1.3.6.1.4.1.12356.101.4.9.2.1.14]'
          key: fgVWLHealthCheckLink
          delay: 1h
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'FORTINET-FORTIGATE-MIB::fgVWLHealthCheckLinkTable'
          item_prototypes:
            - uuid: 26bfae6312b3417a905a9e2b21fed797
              name: 'SLA {#SNMPVALUE} ({#SNMPVDOM}/{#SNMPINTF}) Jitter'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.4.9.2.1.6.{#SNMPINDEX}'
              key: 'fgVWLHealthCheckLinkJitter.[{#SNMPINDEX}]'
              history: 90d
              value_type: FLOAT
              units: ms
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - 'return parseFloat(value);'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sdwan
                - tag: interface
                  value: '{#SNMPINTF}'
                - tag: vdom
                  value: '{#SNMPVDOM}'
              trigger_prototypes:
                - uuid: 3abc36c4ea3e4822867ebb8ace3b6804
                  expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkJitter.[{#SNMPINDEX}],15m)>{$FW.SDWAN.JITTER.CRIT}'
                  name: 'SLA {#SNMPVALUE} Jitter exceeds critical threshold'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}; Current: {ITEM.VALUE1}; Previous: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'The current jitter value exceeds the threshold configured'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'SLA {#SNMPVALUE} State Dead'
                      expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
                - uuid: 096132f3098c4a44a45a2696422cc37e
                  expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkJitter.[{#SNMPINDEX}],15m)>{$FW.SDWAN.JITTER.WARN}'
                  name: 'SLA {#SNMPVALUE} Jitter exceeds warning threshold'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}; Current: {ITEM.VALUE1}; Previous: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The current jitter value exceeds the threshold configured'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'SLA {#SNMPVALUE} Jitter exceeds critical threshold'
                      expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkJitter.[{#SNMPINDEX}],15m)>{$FW.SDWAN.JITTER.CRIT}'
                    - name: 'SLA {#SNMPVALUE} State Dead'
                      expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
            - uuid: c960fb3295f44e4a8710633c6b9f65e3
              name: 'SLA {#SNMPVALUE} ({#SNMPVDOM}/{#SNMPINTF}) Latency'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.4.9.2.1.5.{#SNMPINDEX}'
              key: 'fgVWLHealthCheckLinkLatency.[{#SNMPINDEX}]'
              history: 90d
              value_type: FLOAT
              units: ms
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - 'return parseFloat(value);'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sdwan
                - tag: interface
                  value: '{#SNMPINTF}'
                - tag: vdom
                  value: '{#SNMPVDOM}'
              trigger_prototypes:
                - uuid: 5b11ebab3dfe48b4a3f5a8310818d37a
                  expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkLatency.[{#SNMPINDEX}],15m)>{$FW.SDWAN.LATENCY.CRIT}'
                  name: 'SLA {#SNMPVALUE} Latency exceeds critical threshold'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}; Current: {ITEM.VALUE1}; Previous: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'The current latency value exceeds the threshold configured'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'SLA {#SNMPVALUE} State Dead'
                      expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
                - uuid: 22e729dbd0e941f4bab87dee5ac3000a
                  expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkLatency.[{#SNMPINDEX}],15m)>{$FW.SDWAN.LATENCY.WARN}'
                  name: 'SLA {#SNMPVALUE} Latency exceeds warning threshold'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}; Current: {ITEM.VALUE1}; Previous: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The current latency value exceeds the threshold configured'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'SLA {#SNMPVALUE} Latency exceeds critical threshold'
                      expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkLatency.[{#SNMPINDEX}],15m)>{$FW.SDWAN.LATENCY.CRIT}'
                    - name: 'SLA {#SNMPVALUE} State Dead'
                      expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
            - uuid: 19f9d5022696418ab56dfd4b08038f95
              name: 'SLA {#SNMPVALUE} ({#SNMPVDOM}/{#SNMPINTF}) Packet Loss'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.4.9.2.1.9.{#SNMPINDEX}'
              key: 'fgVWLHealthCheckLinkPacketLoss.[{#SNMPINDEX}]'
              history: 90d
              units: '%'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sdwan
                - tag: interface
                  value: '{#SNMPINTF}'
                - tag: vdom
                  value: '{#SNMPVDOM}'
              trigger_prototypes:
                - uuid: 7e33d41e8b4a4f99bf7bf9edc5cc8872
                  expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkPacketLoss.[{#SNMPINDEX}],15m)>{$FW.SDWAN.LOSS.CRIT}'
                  name: 'SLA {#SNMPVALUE} Packet loss exceeds critical threshold'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}; Current: {ITEM.VALUE1}; Previous: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'The current loss value exceeds the threshold configured'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'SLA {#SNMPVALUE} State Dead'
                      expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
                - uuid: d8e468fd75c54369bcef8a313af6984d
                  expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkPacketLoss.[{#SNMPINDEX}],15m)>{$FW.SDWAN.LOSS.WARN}'
                  name: 'SLA {#SNMPVALUE} Packet loss exceeds warning threshold'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}; Current: {ITEM.VALUE1}; Previous: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The current loss value exceeds the threshold configured'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                    - name: 'SLA {#SNMPVALUE} Packet loss exceeds critical threshold'
                      expression: 'avg(/Pylon Fortigate Template/fgVWLHealthCheckLinkPacketLoss.[{#SNMPINDEX}],15m)>{$FW.SDWAN.LOSS.CRIT}'
                    - name: 'SLA {#SNMPVALUE} State Dead'
                      expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
            - uuid: 2d35753ac73147bcb4697d6630606777
              name: 'SLA {#SNMPVALUE} ({#SNMPVDOM}/{#SNMPINTF}) Link State'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.12356.101.4.9.2.1.4.{#SNMPINDEX}'
              key: 'fgVWLHealthCheckLinkState.[{#SNMPINDEX}]'
              history: 2w
              trends: '0'
              description: 'SDWAN Health Check Status'
              valuemap:
                name: 'Fortigate SDWAN State'
              tags:
                - tag: component
                  value: health
                - tag: component
                  value: sdwan
                - tag: interface
                  value: '{#SNMPINTF}'
                - tag: vdom
                  value: '{#SNMPVDOM}'
              trigger_prototypes:
                - uuid: 31025c96b0584b028cbac6231d53a719
                  expression: 'last(/Pylon Fortigate Template/fgVWLHealthCheckLinkState.[{#SNMPINDEX}])<>0'
                  name: 'SLA {#SNMPVALUE} State Dead'
                  opdata: 'VDOM: {#SNMPVDOM}; WAN Interface: {#SNMPINTF}'
                  priority: WARNING
                  description: 'The state of the SDWAN Performance SLA is not alive(0)'
                  dependencies:
                    - name: 'No SNMP data collection'
                      expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
                  tags:
                    - tag: component
                      value: sdwan
                    - tag: interface
                      value: '{#SNMPINTF}'
      tags:
        - tag: IsUPS
          value: 'False'
      macros:
        - macro: '{$FW.CPU.CRIT}'
          value: '80'
          description: 'CPU Percentage Critical Threshold'
        - macro: '{$FW.CPU.WARN}'
          value: '60'
          description: 'CPU Percentage Warning Threshold'
        - macro: '{$FW.MEM.CRIT}'
          value: '80'
          description: 'Memory Percentage Critical Threshold'
        - macro: '{$FW.MEM.WARN}'
          value: '60'
          description: 'Memory Percentage Warning Threshold'
        - macro: '{$FW.SDWAN.JITTER.CRIT}'
          value: '60'
          description: 'SDWAN Jitter Critical ms'
        - macro: '{$FW.SDWAN.JITTER.WARN}'
          value: '30'
          description: 'SDWAN Jitter Warning ms'
        - macro: '{$FW.SDWAN.LATENCY.CRIT}'
          value: '300'
          description: 'SDWAN Latency Critical ms'
        - macro: '{$FW.SDWAN.LATENCY.WARN}'
          value: '150'
          description: 'SDWAN Latency Warning ms'
        - macro: '{$FW.SDWAN.LOSS.CRIT}'
          value: '50'
          description: 'SDWAN Loss Critical %'
        - macro: '{$FW.SDWAN.LOSS.WARN}'
          value: '20'
          description: 'SDWAN Loss Warning %'
        - macro: '{$NET.IF.IFNAME.NOT_MATCHES}'
          value: '(^(.*)\.root|^Software Loopback Interface|^NULL[0-9.]*$|^[Ll]o[0-9.]*$|^[Ss]ystem$|^Nu[0-9.]*$|^veth[0-9a-z]+$|docker[0-9]+|br-[a-z0-9]{12})'
          description: 'Filter out loopbacks, nulls, docker veth links and docker0 bridge by default'
      valuemaps:
        - uuid: e22ea6c723a9440e8e4f74a5bf8815db
          name: 'Fortigate HA Auto Sync'
          mappings:
            - value: '1'
              newvalue: Disabled
            - value: '2'
              newvalue: Enabled
        - uuid: d4aa4fa728fa4bbcb434636d970c4080
          name: 'Fortigate HA Status'
          mappings:
            - value: '1'
              newvalue: Standalone
            - value: '2'
              newvalue: Active/Active
            - value: '3'
              newvalue: Active/Standby
        - uuid: 675f4dc95948406f8c53793d2cb0da80
          name: 'Fortigate HA Sync State'
          mappings:
            - value: '0'
              newvalue: unsynchronized
            - value: '1'
              newvalue: synchronized
        - uuid: da01caa182314fa6ba260e9b29dd79f5
          name: 'Fortigate SDWAN State'
          mappings:
            - value: '0'
              newvalue: alive
            - value: '1'
              newvalue: dead
        - uuid: 9760a57e2915448a8ce4a2dfc1e9ceeb
          name: 'Fortigate Sensor Alarm State'
          mappings:
            - value: '0'
              newvalue: Cleared
            - value: '1'
              newvalue: Alarm
        - uuid: e1af631f2c4e4ceaa0b11490f6daaab6
          name: 'Fortigate VDOM Operation Mode'
          mappings:
            - value: '1'
              newvalue: nat
            - value: '2'
              newvalue: transparent
  triggers:
    - uuid: ecac738dfcf14b798dd851a1cc39ce71
      expression: '(last(/Pylon Fortigate Template/system.hw.uptime[hrSystemUptime.0])>0 and last(/Pylon Fortigate Template/system.hw.uptime[hrSystemUptime.0])<10m) or (last(/Pylon Fortigate Template/system.hw.uptime[hrSystemUptime.0])=0 and last(/Pylon Fortigate Template/system.net.uptime[sysUpTime.0])<10m)'
      name: 'Firewall has been restarted'
      event_name: '{HOST.NAME} has been restarted (uptime < 10m)'
      priority: WARNING
      description: 'Uptime is less than 10 minutes.'
      manual_close: 'YES'
      dependencies:
        - name: 'No SNMP data collection'
          expression: 'max(/Pylon Fortigate Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
      tags:
        - tag: scope
          value: notice
