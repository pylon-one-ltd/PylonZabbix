zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: bf8846d58f414cd488b718c930236658
      name: 'Templates/Pylon Templates'
  templates:
    - uuid: 8567d62009384a33ac96be9c7b8a4e9c
      template: 'Pylon Peplink FusionHub Template'
      name: 'Pylon Peplink FusionHub Template'
      description: 'Built for Peplink FusionHub based on SNMP mibs for 8.1.x or newer firmware'
      templates:
        - name: 'ICMP Ping'
      groups:
        - name: 'Templates/Pylon Templates'
      items:
        - uuid: ca5becc0ffc5424fa42944bb6ef6296c
          name: 'CPU Usage %'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.3.1.0
          key: cpuUsage
          delay: 30s
          history: 2w
          units: '%'
          description: 'CPU usage in percentage'
          tags:
            - tag: component
              value: CPU
          triggers:
            - uuid: 1a9abc36df55410c99a26074a599660c
              expression: 'avg(/Pylon Peplink FusionHub Template/cpuUsage,{$CPU.AVG.TIME})>={$CPU.CRIT}'
              name: 'CPU Usage Critical'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'CPU usage is above critical threshold'
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: CPU
            - uuid: a05062b8056449238d77ef6f65fee8bf
              expression: 'avg(/Pylon Peplink FusionHub Template/cpuUsage,{$CPU.AVG.TIME})>={$CPU.WARN}'
              name: 'CPU Usage Warning'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'CPU usage is above warning threshold'
              dependencies:
                - name: 'CPU Usage Critical'
                  expression: 'avg(/Pylon Peplink FusionHub Template/cpuUsage,{$CPU.AVG.TIME})>={$CPU.CRIT}'
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: CPU
        - uuid: 794395a4d8d94251b05103a1cfc14ee7
          name: 'Total Physical Memory'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.3.2.0
          key: hrStorageSize
          delay: 1d
          history: 1w
          trends: '0'
          units: B
          description: 'Available system memory in kilobytes'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: component
              value: memory
        - uuid: 46e13badb05047ac90ae8a26e434055b
          name: 'Used Physical Memory'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.3.3.0
          key: hrStorageUsed
          history: 2w
          units: B
          description: 'Consumed system memory in kilobytes'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: component
              value: memory
        - uuid: ead4c83c6d424a0b9c1f9bd10c9feabf
          name: 'Memory Usage %'
          type: CALCULATED
          key: memoryUsagePercent
          delay: 30s
          history: 2w
          units: '%'
          params: '(last(//hrStorageUsed)/last(//hrStorageSize))*100'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: c9129d95bfd34ef69eb14f321aaa3971
              expression: 'last(/Pylon Peplink FusionHub Template/memoryUsagePercent)>={$MEM.CRIT}'
              name: 'Memory Usage Critical'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'Memory usage is above critical threshold'
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: memory
            - uuid: e6d8a604fad849bcb482a72e09033c25
              expression: 'last(/Pylon Peplink FusionHub Template/memoryUsagePercent)>={$MEM.WARN}'
              name: 'Memory Usage Warning'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'Memory usage is above warning threshold'
              dependencies:
                - name: 'Memory Usage Critical'
                  expression: 'last(/Pylon Peplink FusionHub Template/memoryUsagePercent)>={$MEM.CRIT}'
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: memory
        - uuid: c44e01e355bc45f8b9a25fcd1ba09520
          name: 'Peplink Firmware'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.1.3.0
          key: peplinkFirmware
          delay: 1d
          history: 1w
          value_type: TEXT
          trends: '0'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: b8ba4ecca7794cf78f80e8604d785d52
              expression: 'last(/Pylon Peplink FusionHub Template/peplinkFirmware,#1)<>last(/Pylon Peplink FusionHub Template/peplinkFirmware,#2) and length(last(/Pylon Peplink FusionHub Template/peplinkFirmware))>0'
              name: 'Peplink Firmware has changed'
              event_name: 'Firmware has changed (new firmware: {ITEM.VALUE})'
              priority: INFO
              description: 'System firmware has changed. Ack to close.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: security
        - uuid: dded795c4c5b46ba919590ebff70aaf0
          name: 'Peplink Model'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.1.1.0
          key: peplinkModel
          delay: 1d
          history: 1w
          value_type: TEXT
          trends: '0'
          tags:
            - tag: component
              value: system
        - uuid: 65829ee839874c59880f7361facc96c7
          name: 'Peplink Serial'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.1.2.0
          key: peplinkSerial
          delay: 1d
          history: 1w
          value_type: TEXT
          trends: '0'
          tags:
            - tag: component
              value: system
        - uuid: cc2153559e8c48238bf8da1fae0bdaf7
          name: 'System contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: 'system.contact[sysContact.0]'
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            The textual identification of the contact person for this managed node, together with information on how to contact this person.  If no contact information is known, the value is the zero-length string.
          inventory_link: CONTACT
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 85ff5e20a9bc4627a39ac0c17b1cda06
          name: 'System description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: 'system.descr[sysDescr.0]'
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            A textual description of the entity. This value should
            include the full name and version identification of the system's hardware type, software operating-system, and
            networking software.
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 6d4f84ac964a482ebd5826ecc2172ff2
          name: 'Uptime (hardware)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.1.1.0
          key: 'system.hw.uptime[hrSystemUptime.0]'
          history: 2w
          trends: '0'
          units: uptime
          description: |
            MIB: HOST-RESOURCES-MIB
            The amount of time since this host was last initialized. Note that this is different from sysUpTime in the SNMPv2-MIB [RFC1907] because sysUpTime is the uptime of the network management portion of the system.
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
              error_handler: CUSTOM_VALUE
              error_handler_params: '0'
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: component
              value: system
        - uuid: ce1541e00eb84c6fa4c66876351ccf27
          name: 'System location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: 'system.location[sysLocation.0]'
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            The physical location of this node (e.g., `telephone closet, 3rd floor').  If the location is unknown, the value is the zero-length string.
          inventory_link: LOCATION
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 75b2e6e60154461e9e3f1c0a940019a1
          name: 'System name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          delay: 1d
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            An administratively-assigned name for this managed node.By convention, this is the node's fully-qualified domain name.  If the name is unknown, the value is the zero-length string.
          inventory_link: NAME
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 48056d60a8e4427cad0fa9eeacc69b3b
              expression: 'last(/Pylon Peplink FusionHub Template/system.name,#1)<>last(/Pylon Peplink FusionHub Template/system.name,#2) and length(last(/Pylon Peplink FusionHub Template/system.name))>0'
              name: 'System name has changed'
              event_name: 'System name has changed (new name: {ITEM.VALUE})'
              priority: INFO
              description: 'System name has changed. Ack to close.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: security
        - uuid: ac2b5b5d538f4b60a9df451ceb695025
          name: 'Uptime (network)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          history: 2w
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: component
              value: system
        - uuid: da6b63fd3e5a4b789ddaec273ada2aa9
          name: 'SNMP agent availability'
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 2w
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          valuemap:
            name: zabbix.host.available
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: eaea00b71ea644c38f4df0a407a1a5eb
              expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: 'No SNMP data collection'
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              dependencies:
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/Pylon Peplink FusionHub Template/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: 0e3c31b70b434037a0a6005fc41202de
          name: 'Interface Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFOPERSTATUS},1.3.6.1.2.1.2.2.1.8,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7,{#IFNAME},1.3.6.1.2.1.2.2.1.2,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#IFTYPE}'
                value: '{$PL.IFTYPE.FILTER}'
                operator: NOT_MATCHES_REGEX
                formulaid: A
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'Discovering interfaces from IF-MIB.'
          item_prototypes:
            - uuid: ad5378f77b07490fb049e3cc733bd585
              name: 'Interface {#IFDESCR}: Inbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.13.{#SNMPINDEX}'
              key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
              delay: 5m
              history: 2w
              description: |
                MIB: IF-MIB
                The number of inbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: 16dddad3fd9f4635b30f95a1b08098d9
              name: 'Interface {#IFDESCR}: Inbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
              delay: 5m
              history: 2w
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of inbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of inbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: f1a6e3ac1feb4f8a9573ee9e30dae1b0
              name: 'Interface {#IFDESCR}: Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'net.if.in[ifHCInOctets.{#SNMPINDEX}]'
              delay: 30s
              history: 2w
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets received on the interface,including framing characters. Discontinuities in the value of this counter can occur at re-initialization of the management system, and atother times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: network
            - uuid: 1430e271776b4ea49cd97733fcb87344
              name: 'Interface {#IFDESCR}: Outbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.19.{#SNMPINDEX}'
              key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
              delay: 5m
              history: 2w
              description: |
                MIB: IF-MIB
                The number of outbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: fe075c9aa41041f9bb61794117527a69
              name: 'Interface {#IFDESCR}: Outbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
              delay: 5m
              history: 2w
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of outbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of outbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: 32ba553ef95f4a3c909ff7edf833bd33
              name: 'Interface {#IFDESCR}: Bits sent'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
              delay: 30s
              history: 2w
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets transmitted out of the interface, including framing characters. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: network
            - uuid: 6323cf445ae44d9190113a36149bfd69
              name: 'Interface {#IFDESCR}: Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.5.{#SNMPINDEX}'
              key: 'net.if.speed[ifSpeed.{#SNMPINDEX}]'
              delay: 10m
              history: 2w
              trends: '0'
              units: bps
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in bits per second.
                For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made,
                this object should contain the nominal bandwidth.
                If the bandwidth of the interface is greater than the maximum value reportable by this object then
                this object should report its maximum value (4,294,967,295) and ifHighSpeed must be used to report the interface's speed.
                For a sub-layer which has no concept of bandwidth, this object should be zero.
              tags:
                - tag: component
                  value: network
            - uuid: d45ed5bbfbc74032a1d3b61d8f2b26aa
              name: 'Interface {#IFDESCR}: Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[ifOperStatus.{#SNMPINDEX}]'
              delay: 10m
              history: 2w
              trends: '0'
              description: |
                MIB: IF-MIB
                The current operational state of the interface.
                - The testing(3) state indicates that no operational packet scan be passed
                - If ifAdminStatus is down(2) then ifOperStatus should be down(2)
                - If ifAdminStatus is changed to up(1) then ifOperStatus should change to up(1) if the interface is ready to transmit and receive network traffic
                - It should change todormant(5) if the interface is waiting for external actions (such as a serial line waiting for an incoming connection)
                - It should remain in the down(2) state if and only if there is a fault that prevents it from going to the up(1) state
                - It should remain in the notPresent(6) state if the interface has missing(typically, hardware) components.
              valuemap:
                name: 'IF-MIB::ifOperStatus'
              tags:
                - tag: component
                  value: network
              trigger_prototypes:
                - uuid: 9905ab15aebf4515a4e5ff5ea59014ea
                  expression: 'last(/Pylon Peplink FusionHub Template/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Pylon Peplink FusionHub Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Pylon Peplink FusionHub Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/Pylon Peplink FusionHub Template/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
                  name: 'Interface {#IFDESCR}: Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'A link that was previously up is now down'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
          trigger_prototypes:
            - uuid: a90aed528ca2436ebbd973fe03c1bb04
              expression: |
                (avg(/Pylon Peplink FusionHub Template/net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Pylon Peplink FusionHub Template/net.if.speed[ifSpeed.{#SNMPINDEX}]) or
                avg(/Pylon Peplink FusionHub Template/net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Pylon Peplink FusionHub Template/net.if.speed[ifSpeed.{#SNMPINDEX}])) and
                last(/Pylon Peplink FusionHub Template/net.if.speed[ifSpeed.{#SNMPINDEX}])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/Pylon Peplink FusionHub Template/net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Pylon Peplink FusionHub Template/net.if.speed[ifSpeed.{#SNMPINDEX}]) and
                avg(/Pylon Peplink FusionHub Template/net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Pylon Peplink FusionHub Template/net.if.speed[ifSpeed.{#SNMPINDEX}])
              name: 'Interface {#IFDESCR}: High bandwidth usage'
              event_name: 'Interface {#IFDESCR}: High bandwidth usage (>{$IF.UTIL.MAX:"{#IFNAME}"}%)'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'The network interface utilization is close to its estimated maximum bandwidth.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: performance
            - uuid: 832feff756ad4ab2955caf7d38265b4c
              expression: |
                min(/Pylon Peplink FusionHub Template/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
                or min(/Pylon Peplink FusionHub Template/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                max(/Pylon Peplink FusionHub Template/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
                and max(/Pylon Peplink FusionHub Template/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFDESCR}: High error rate'
              event_name: 'Interface {#IFDESCR}: High error rate (>{$IF.ERRORS.WARN:"{#IFNAME}"} for 5m)'
              opdata: 'errors in: {ITEM.LASTVALUE1}, errors out: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'Recovers when below 80% of {$IF.ERRORS.WARN:"{#IFNAME}"} threshold'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: performance
          graph_prototypes:
            - uuid: b524b12def32423d8f0b6683ab4c89fe
              name: 'Interface {#IFDESCR}: Network traffic'
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: 'Pylon Peplink FusionHub Template'
                    key: 'net.if.in[ifHCInOctets.{#SNMPINDEX}]'
                - sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 2774A4
                  item:
                    host: 'Pylon Peplink FusionHub Template'
                    key: 'net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
                - sortorder: '2'
                  color: F63100
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink FusionHub Template'
                    key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
                - sortorder: '3'
                  color: A54F10
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink FusionHub Template'
                    key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
                - sortorder: '4'
                  color: FC6EA3
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink FusionHub Template'
                    key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
                - sortorder: '5'
                  color: 6C59DC
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink FusionHub Template'
                    key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
        - uuid: 33a6b5cd48b948d487113a8c256d1471
          name: 'PepVPN Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#PEPVPNID},.1.3.6.1.4.1.23695.200.1.10.1.1.2.1.1,{#PEPVPNIFNAME},.1.3.6.1.4.1.23695.200.1.10.1.1.2.1.2]'
          key: pepvpn.discovery
          delay: 10m
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'Discover PepVPN Endpoints'
          item_prototypes:
            - uuid: fe4fba8c8dd94495b4d516a7ee29def9
              name: 'Profile {#PEPVPNIFNAME} Connection State'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.23695.200.1.10.1.1.2.1.3["index",".1.3.6.1.4.1.23695.200.1.10.1.1.2.1.1", "{#PEPVPNID}"]'
              key: 'pepvpn.StatusConnectionState[{#PEPVPNID}]'
              history: 2w
              description: 'The state of the PepVPN Tunnel'
              valuemap:
                name: pepvpn.connectionstate
              tags:
                - tag: component
                  value: pepvpn
            - uuid: 898958e4d3a043f199926117a001ad90
              name: 'Profile {#PEPVPNIFNAME} WAN Dropped Packets'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.23695.200.1.10.1.1.3.1.5.{#PEPVPNID}.1.1'
              key: 'pepvpn.wanIfDropped[{#PEPVPNID},1]'
              history: 2w
              units: bps
              description: 'Total bits dropped via this WAN interface in the PepVPN tunnel'
              preprocessing:
                - type: CHECK_NOT_SUPPORTED
                  parameters:
                    - '-1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: pepvpn
              trigger_prototypes:
                - uuid: 4b7f34c18c234e8a951acb129d7aca24
                  expression: 'avg(/Pylon Peplink FusionHub Template/pepvpn.wanIfDropped[{#PEPVPNID},1],3m)>={$PL.VPN.DROP.CRIT}'
                  name: 'Tunnel {#PEPVPNIFNAME} Interface Drops Critical'
                  opdata: 'Current Value: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Dropped packets on WAN interface exceeds defined critical limit'
                  tags:
                    - tag: component
                      value: pepvpn
                - uuid: 984114a3120848898b7f1fdfc6163c30
                  expression: 'avg(/Pylon Peplink FusionHub Template/pepvpn.wanIfDropped[{#PEPVPNID},1],3m)>={$PL.VPN.DROP.WARN}'
                  name: 'Tunnel {#PEPVPNIFNAME} Interface Drops Warning'
                  opdata: 'Current Value: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'Dropped packets on WAN interface exceeds defined warning limit'
                  dependencies:
                    - name: 'Tunnel {#PEPVPNIFNAME} Interface Drops Critical'
                      expression: 'avg(/Pylon Peplink FusionHub Template/pepvpn.wanIfDropped[{#PEPVPNID},1],3m)>={$PL.VPN.DROP.CRIT}'
                  tags:
                    - tag: component
                      value: pepvpn
            - uuid: 4a3455a7704d4d48afe3526778388d72
              name: 'Profile {#PEPVPNIFNAME} WAN Latency'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.23695.200.1.10.1.1.3.1.6.{#PEPVPNID}.1.1'
              key: 'pepvpn.wanIfLatency[{#PEPVPNID},1]'
              history: 2w
              units: ms
              description: 'Latency to remote peer via this WAN interface in the PepVPN tunnel'
              preprocessing:
                - type: CHECK_NOT_SUPPORTED
                  parameters:
                    - '-1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              tags:
                - tag: component
                  value: pepvpn
              trigger_prototypes:
                - uuid: 37a37474247f40129a85f28b551c948d
                  expression: 'avg(/Pylon Peplink FusionHub Template/pepvpn.wanIfLatency[{#PEPVPNID},1],3m)>={$PL.VPN.LATENCY.CRIT}'
                  name: 'Tunnel {#PEPVPNIFNAME} Interface Latency Critical'
                  opdata: 'Current Value: {ITEM.LASTVALUE1}'
                  status: DISABLED
                  priority: AVERAGE
                  description: 'Latency on WAN interface exceeds defined critical limit'
                  tags:
                    - tag: component
                      value: pepvpn
                - uuid: 2c470a1631fb445c8b9b5cd7700ea01e
                  expression: 'avg(/Pylon Peplink FusionHub Template/pepvpn.wanIfLatency[{#PEPVPNID},1],3m)>={$PL.VPN.LATENCY.WARN}'
                  name: 'Tunnel {#PEPVPNIFNAME} Interface Latency Warning'
                  opdata: 'Current Value: {ITEM.LASTVALUE1}'
                  status: DISABLED
                  priority: WARNING
                  description: 'Latency on WAN interface exceeds defined warning limit'
                  dependencies:
                    - name: 'Tunnel {#PEPVPNIFNAME} Interface Latency Critical'
                      expression: 'avg(/Pylon Peplink FusionHub Template/pepvpn.wanIfLatency[{#PEPVPNID},1],3m)>={$PL.VPN.LATENCY.CRIT}'
                  tags:
                    - tag: component
                      value: pepvpn
            - uuid: ed249beff8334a3c99cfddd3425a078b
              name: 'Profile {#PEPVPNIFNAME} WAN Interface Name'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.23695.200.1.10.1.1.3.1.2.{#PEPVPNID}.1.1'
              key: 'pepvpn.wanIfName[{#PEPVPNID},1]'
              delay: 1h
              history: 1w
              value_type: TEXT
              trends: '0'
              description: 'Name of WAN 1 Interface in tunnel'
              preprocessing:
                - type: CHECK_NOT_SUPPORTED
                  parameters:
                    - '-1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: 'Interface offline or not connected'
              tags:
                - tag: component
                  value: pepvpn
            - uuid: 7fef9a34c57f4c2e94532155d60e46ca
              name: 'Profile {#PEPVPNIFNAME} WAN Bits Received'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.23695.200.1.10.1.1.3.1.4.{#PEPVPNID}.1.1'
              key: 'pepvpn.wanIfOctetIn[{#PEPVPNID},1]'
              history: 2w
              units: bps
              description: 'Total bits received via this WAN interface in the PepVPN tunnel'
              preprocessing:
                - type: CHECK_NOT_SUPPORTED
                  parameters:
                    - '-1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: pepvpn
            - uuid: 8cd3fe65d6da4b918d90c9e34d5cdc93
              name: 'Profile {#PEPVPNIFNAME} WAN Bits Sent'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.23695.200.1.10.1.1.3.1.3.{#PEPVPNID}.1.1'
              key: 'pepvpn.wanIfOctetOut[{#PEPVPNID},1]'
              history: 2w
              units: bps
              description: 'Total bits sent via this WAN interface in the PepVPN tunnel'
              preprocessing:
                - type: CHECK_NOT_SUPPORTED
                  parameters:
                    - '-1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: pepvpn
          trigger_prototypes:
            - uuid: 717c97ae863843319863e6cace17288a
              expression: '(not last(/Pylon Peplink FusionHub Template/system.descr[sysDescr.0])="Peplink FusionHub") and last(/Pylon Peplink FusionHub Template/pepvpn.StatusConnectionState[{#PEPVPNID}])<>4'
              name: 'Tunnel {#PEPVPNIFNAME} Down'
              opdata: 'Current tunnel state: {ITEM.LASTVALUE1}'
              status: DISABLED
              priority: INFO
              description: 'Device is online and responding to SNMP, but the PepVPN tunnel is not ready to handle traffic'
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: component
                  value: pepvpn
      tags:
        - tag: IsUPS
          value: 'False'
      macros:
        - macro: '{$CPU.AVG.TIME}'
          value: 3m
        - macro: '{$CPU.CRIT}'
          value: '80'
        - macro: '{$CPU.WARN}'
          value: '60'
        - macro: '{$IF.ERRORS.WARN}'
          value: '2'
        - macro: '{$IF.UTIL.MAX}'
          value: '95'
        - macro: '{$MEM.CRIT}'
          value: '80'
        - macro: '{$MEM.WARN}'
          value: '60'
        - macro: '{$PL.IFTYPE.FILTER}'
          value: ^1$
          description: 'Filter "other" ifType which corresponds to FH tunnels'
        - macro: '{$PL.VPN.DROP.CRIT}'
          value: '500000'
          description: 'Critical level for dropped packets on pepvpn interface in bits'
        - macro: '{$PL.VPN.DROP.WARN}'
          value: '100000'
          description: 'Warning level for dropped packets on pepvpn interface in bits'
        - macro: '{$PL.VPN.LATENCY.CRIT}'
          value: '300'
          description: 'Critical level for tunnel latency on pepvpn interface'
        - macro: '{$PL.VPN.LATENCY.WARN}'
          value: '150'
          description: 'Warning level for tunnel latency on pepvpn interface'
        - macro: '{$SNMP.TIMEOUT}'
          value: 5m
      valuemaps:
        - uuid: edd558d1db8f450b97f624b2a42ce958
          name: 'IF-MIB::ifOperStatus'
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
            - value: '4'
              newvalue: unknown
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: notPresent
            - value: '7'
              newvalue: lowerLayerDown
        - uuid: 7a2b4673cd6e413a8e78aeab8ca10574
          name: pepvpn.connectionstate
          mappings:
            - value: '0'
              newvalue: start
            - value: '1'
              newvalue: authen
            - value: '2'
              newvalue: tunnel
            - value: '3'
              newvalue: route
            - value: '4'
              newvalue: connected
        - uuid: 92f3f28cbbad4e7c80e23e7b0a3ce50c
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
  triggers:
    - uuid: 903a57e666404347b2569eac7b817508
      expression: '(last(/Pylon Peplink FusionHub Template/system.hw.uptime[hrSystemUptime.0])>0 and last(/Pylon Peplink FusionHub Template/system.hw.uptime[hrSystemUptime.0])<10m) or (last(/Pylon Peplink FusionHub Template/system.hw.uptime[hrSystemUptime.0])=0 and last(/Pylon Peplink FusionHub Template/system.net.uptime[sysUpTime.0])<10m)'
      name: 'FusionHub has been restarted'
      event_name: '{HOST.NAME} has been restarted (uptime < 10m)'
      priority: WARNING
      description: 'Uptime is less than 10 minutes.'
      manual_close: 'YES'
      dependencies:
        - name: 'No SNMP data collection'
          expression: 'max(/Pylon Peplink FusionHub Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
      tags:
        - tag: scope
          value: notice
