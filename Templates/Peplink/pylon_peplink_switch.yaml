zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: bf8846d58f414cd488b718c930236658
      name: 'Templates/Pylon Templates'
  templates:
    - uuid: 21fad9e1be2b4280b9f30f51935290ba
      template: 'Pylon Peplink Switch Template'
      name: 'Pylon Peplink Switch Template'
      templates:
        - name: 'ICMP Ping'
      groups:
        - name: 'Templates/Pylon Templates'
      items:
        - uuid: 9ace4ed85ecf459daab639ea049cbaba
          name: 'CPU Usage %'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.3.1.0
          key: cpuUsage
          delay: 30s
          history: 2w
          units: '%'
          description: 'CPU usage in percentage'
          tags:
            - tag: component
              value: CPU
          triggers:
            - uuid: 50572b6d72ed46b8ad07a369594d173e
              expression: 'avg(/Pylon Peplink Switch Template/cpuUsage,{$CPU.AVG.TIME})>={$CPU.CRIT}'
              name: 'CPU Usage Critical'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'CPU usage is above critical threshold'
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink Switch Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: CPU
            - uuid: 274353df83844052b8fc41931015d8fc
              expression: 'avg(/Pylon Peplink Switch Template/cpuUsage,{$CPU.AVG.TIME})>={$CPU.WARN}'
              name: 'CPU Usage Warning'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'CPU usage is above warning threshold'
              dependencies:
                - name: 'CPU Usage Critical'
                  expression: 'avg(/Pylon Peplink Switch Template/cpuUsage,{$CPU.AVG.TIME})>={$CPU.CRIT}'
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink Switch Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: CPU
        - uuid: 1cd310a4b4fd4ca38d7be0ccff32e1c4
          name: 'Total Physical Memory'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.3.2.0
          key: hrStorageSize
          delay: 1d
          history: 1w
          trends: '0'
          units: B
          description: 'Available system memory in kilobytes'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: component
              value: memory
        - uuid: aa3844bf9ab5477b8326631af3d1ecba
          name: 'Used Physical Memory'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.3.3.0
          key: hrStorageUsed
          history: 2w
          units: B
          description: 'Consumed system memory in kilobytes'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: component
              value: memory
        - uuid: 7e2870eccfd94ccb8f4671a57d96c612
          name: 'Memory Usage %'
          type: CALCULATED
          key: memoryUsagePercent
          delay: 30s
          history: 2w
          units: '%'
          params: '(last(//hrStorageUsed)/last(//hrStorageSize))*100'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: 8244819a92724c72a5021c96fe347b21
              expression: 'last(/Pylon Peplink Switch Template/memoryUsagePercent)>={$MEM.CRIT}'
              name: 'Memory Usage Critical'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'Memory usage is above critical threshold'
              dependencies:
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink Switch Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: memory
            - uuid: 6121906d36ba4d5e87330023aaeea3cf
              expression: 'last(/Pylon Peplink Switch Template/memoryUsagePercent)>={$MEM.WARN}'
              name: 'Memory Usage Warning'
              opdata: 'Percentage: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'Memory usage is above warning threshold'
              dependencies:
                - name: 'Memory Usage Critical'
                  expression: 'last(/Pylon Peplink Switch Template/memoryUsagePercent)>={$MEM.CRIT}'
                - name: 'No SNMP data collection'
                  expression: 'max(/Pylon Peplink Switch Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              tags:
                - tag: scope
                  value: memory
        - uuid: 7ab30ce23c114658b6af025d97eed220
          name: 'Peplink Firmware'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.1.3.0
          key: peplinkFirmware
          delay: 1d
          history: 1w
          value_type: TEXT
          trends: '0'
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 3ad45387c98b4d0ebea0a9b5f20c4c47
              expression: 'last(/Pylon Peplink Switch Template/peplinkFirmware,#1)<>last(/Pylon Peplink Switch Template/peplinkFirmware,#2) and length(last(/Pylon Peplink Switch Template/peplinkFirmware))>0'
              name: 'Peplink Firmware has changed'
              event_name: 'Firmware has changed (new firmware: {ITEM.VALUE})'
              priority: INFO
              description: 'System firmware has changed. Ack to close.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: security
        - uuid: 983eb6e2bc644d3faa1290d98a24e6c8
          name: 'Peplink Model'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.1.1.0
          key: peplinkModel
          delay: 1d
          history: 1w
          value_type: TEXT
          trends: '0'
          tags:
            - tag: component
              value: system
        - uuid: 285c295bc51c421db22d13fc9d33b17e
          name: 'Peplink Serial'
          type: SNMP_AGENT
          snmp_oid: .1.3.6.1.4.1.23695.200.1.1.1.1.2.0
          key: peplinkSerial
          delay: 1d
          history: 1w
          value_type: TEXT
          trends: '0'
          tags:
            - tag: component
              value: system
        - uuid: 6ccfd32478cc4ca6a38e0ebd128b17e5
          name: 'System contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: 'system.contact[sysContact.0]'
          delay: 15m
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            The textual identification of the contact person for this managed node, together with information on how to contact this person.  If no contact information is known, the value is the zero-length string.
          inventory_link: CONTACT
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 2b4cbf412d04478fb946f8cb0585b608
          name: 'System description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: 'system.descr[sysDescr.0]'
          delay: 15m
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            A textual description of the entity. This value should
            include the full name and version identification of the system's hardware type, software operating-system, and
            networking software.
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 4563b2242a1e4bab99711298232ea02a
          name: 'Uptime (hardware)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.1.1.0
          key: 'system.hw.uptime[hrSystemUptime.0]'
          delay: 30s
          history: 2w
          trends: 0d
          units: uptime
          description: |
            MIB: HOST-RESOURCES-MIB
            The amount of time since this host was last initialized. Note that this is different from sysUpTime in the SNMPv2-MIB [RFC1907] because sysUpTime is the uptime of the network management portion of the system.
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
              error_handler: CUSTOM_VALUE
              error_handler_params: '0'
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: component
              value: system
        - uuid: b73a4276ad714b5fa5adfb6981ce9e51
          name: 'System location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: 'system.location[sysLocation.0]'
          delay: 15m
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            The physical location of this node (e.g., `telephone closet, 3rd floor').  If the location is unknown, the value is the zero-length string.
          inventory_link: LOCATION
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
        - uuid: 0ff74d09315244ecbcfc49957a949232
          name: 'System name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          delay: 15m
          history: 2w
          value_type: CHAR
          trends: '0'
          description: |
            MIB: SNMPv2-MIB
            An administratively-assigned name for this managed node.By convention, this is the node's fully-qualified domain name.  If the name is unknown, the value is the zero-length string.
          inventory_link: NAME
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 28648e3ea577491881a5159132d39220
              expression: 'last(/Pylon Peplink Switch Template/system.name,#1)<>last(/Pylon Peplink Switch Template/system.name,#2) and length(last(/Pylon Peplink Switch Template/system.name))>0'
              name: 'System name has changed'
              event_name: 'System name has changed (new name: {ITEM.VALUE})'
              priority: INFO
              description: 'System name has changed. Ack to close.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: security
        - uuid: e4a33deae28f4dd59f0855177ebebc0e
          name: 'Uptime (network)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          delay: 30s
          history: 2w
          trends: 0d
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: component
              value: system
        - uuid: 4fac22e0e0d64918a824bc47dbf4d472
          name: 'SNMP agent availability'
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 7d
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          valuemap:
            name: zabbix.host.available
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 797808e21d8f4607a7f795dd439f39c4
              expression: 'max(/Pylon Peplink Switch Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: 'No SNMP data collection'
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              dependencies:
                - name: 'Unavailable by ICMP ping'
                  expression: 'max(/Pylon Peplink Switch Template/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: 72d92be5c2234159a5f9b08b2ebb76a3
          name: 'Network interfaces discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFOPERSTATUS},1.3.6.1.2.1.2.2.1.8,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7,{#IFNAME},1.3.6.1.2.1.2.2.1.2,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.MATCHES}'
                formulaid: A
              - macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              - macro: '{#IFDESCR}'
                value: '{$NET.IF.IFDESCR.MATCHES}'
                formulaid: C
              - macro: '{#IFDESCR}'
                value: '{$NET.IF.IFDESCR.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              - macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.MATCHES}'
                formulaid: E
              - macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: F
              - macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.MATCHES}'
                formulaid: G
              - macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: H
              - macro: '{#IFTYPE}'
                value: '{$NET.IF.IFTYPE.MATCHES}'
                formulaid: I
              - macro: '{#IFTYPE}'
                value: '{$NET.IF.IFTYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: J
          lifetime: 30d
          enabled_lifetime_type: DISABLE_NEVER
          description: 'Discovering interfaces from IF-MIB.'
          item_prototypes:
            - uuid: 2d16e8096ca541ca8056c370dfa4328d
              name: 'Interface {#IFDESCR}: Inbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.13.{#SNMPINDEX}'
              key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              description: |
                MIB: IF-MIB
                The number of inbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: 58ccbf8310e64b5da012e8b06a940c58
              name: 'Interface {#IFDESCR}: Inbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of inbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of inbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: 7019acb22dd348b6a335ae692ba36c57
              name: 'Interface {#IFDESCR}: Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'net.if.in[ifInOctets.{#SNMPINDEX}]'
              delay: 30s
              history: 7d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets received on the interface,including framing characters. Discontinuities in the value of this counter can occur at re-initialization of the management system, and atother times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: network
            - uuid: c9a8aeaa525a4bf1ad51837e8038a507
              name: 'Interface {#IFDESCR}: Outbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.19.{#SNMPINDEX}'
              key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              description: |
                MIB: IF-MIB
                The number of outbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: 0232d5645a354b27822ac760608f93b1
              name: 'Interface {#IFDESCR}: Outbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of outbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of outbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: component
                  value: network
            - uuid: 7a41a51bd00b4ecc979cb2e2f08f47c1
              name: 'Interface {#IFDESCR}: Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'net.if.out[ifOutOctets.{#SNMPINDEX}]'
              delay: 30s
              history: 7d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets transmitted out of the interface, including framing characters. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: network
            - uuid: 8af089eda418405483c9402175d51858
              name: 'Interface {#IFDESCR}: Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.5.{#SNMPINDEX}'
              key: 'net.if.speed[ifSpeed.{#SNMPINDEX}]'
              delay: 5m
              history: 7d
              trends: 0d
              units: bps
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in bits per second.
                For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made,
                this object should contain the nominal bandwidth.
                If the bandwidth of the interface is greater than the maximum value reportable by this object then
                this object should report its maximum value (4,294,967,295) and ifHighSpeed must be used to report the interface's speed.
                For a sub-layer which has no concept of bandwidth, this object should be zero.
              tags:
                - tag: component
                  value: network
            - uuid: a014f72513684177afda1a34a9e406bf
              name: 'Interface {#IFDESCR}: Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[ifOperStatus.{#SNMPINDEX}]'
              history: 7d
              trends: '0'
              description: |
                MIB: IF-MIB
                The current operational state of the interface.
                - The testing(3) state indicates that no operational packet scan be passed
                - If ifAdminStatus is down(2) then ifOperStatus should be down(2)
                - If ifAdminStatus is changed to up(1) then ifOperStatus should change to up(1) if the interface is ready to transmit and receive network traffic
                - It should change todormant(5) if the interface is waiting for external actions (such as a serial line waiting for an incoming connection)
                - It should remain in the down(2) state if and only if there is a fault that prevents it from going to the up(1) state
                - It should remain in the notPresent(6) state if the interface has missing(typically, hardware) components.
              valuemap:
                name: 'IF-MIB::ifOperStatus'
              tags:
                - tag: component
                  value: network
              trigger_prototypes:
                - uuid: d233c941dfd84725ba03f2d60674a644
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
                  name: 'Interface {#IFDESCR}: Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    This trigger expression works as follows:
                    1. Can be triggered if operations status is down.
                    2. {$IFCONTROL:"{#IFNAME}"}=1 - user can redefine Context macro to value - 0. That marks this interface as not important. No new trigger will be fired if this interface is down.
                    3. {TEMPLATE_NAME:METRIC.diff()}=1) - trigger fires only if operational status was up(1) sometime before. (So, do not fire 'ethernal off' interfaces.)
                    
                    WARNING: if closed manually - won't fire again on next poll, because of .diff.
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: 37538f5cc8ad41dc9ee9a3bbc463cfab
              name: 'Interface {#IFDESCR}: Interface type'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.3.{#SNMPINDEX}'
              key: 'net.if.type[ifType.{#SNMPINDEX}]'
              delay: 1h
              history: 7d
              trends: 0d
              description: |
                MIB: IF-MIB
                The type of interface.
                Additional values for ifType are assigned by the Internet Assigned Numbers Authority (IANA),
                through updating the syntax of the IANAifType textual convention.
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              tags:
                - tag: component
                  value: network
          trigger_prototypes:
            - uuid: 78c22292ed654a94b6b494692c841820
              expression: |
                change(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}])<0 and last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}])>0
                and (
                last(/Pylon Peplink Switch Template/net.if.type[ifType.{#SNMPINDEX}])=6 or
                last(/Pylon Peplink Switch Template/net.if.type[ifType.{#SNMPINDEX}])=7 or
                last(/Pylon Peplink Switch Template/net.if.type[ifType.{#SNMPINDEX}])=11 or
                last(/Pylon Peplink Switch Template/net.if.type[ifType.{#SNMPINDEX}])=62 or
                last(/Pylon Peplink Switch Template/net.if.type[ifType.{#SNMPINDEX}])=69 or
                last(/Pylon Peplink Switch Template/net.if.type[ifType.{#SNMPINDEX}])=117
                )
                and
                (last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                (change(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}])>0 and last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}],#2)>0) or
                (last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])=2)
              name: 'Interface {#IFDESCR}: Ethernet has changed to lower speed than it was before'
              opdata: 'Current reported speed: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'This Ethernet connection has transitioned down from its known maximum speed. This might be a sign of autonegotiation issues. Ack to close.'
              manual_close: 'YES'
              dependencies:
                - name: 'Interface {#IFDESCR}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))'
                  recovery_expression: 'last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                - tag: scope
                  value: performance
            - uuid: a4f31d5a708848a5809a5c1bf3ad0143
              expression: |
                (avg(/Pylon Peplink Switch Template/net.if.in[ifInOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}]) or
                avg(/Pylon Peplink Switch Template/net.if.out[ifOutOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}])) and
                last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/Pylon Peplink Switch Template/net.if.in[ifInOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}]) and
                avg(/Pylon Peplink Switch Template/net.if.out[ifOutOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Pylon Peplink Switch Template/net.if.speed[ifSpeed.{#SNMPINDEX}])
              name: 'Interface {#IFDESCR}: High bandwidth usage'
              event_name: 'Interface {#IFDESCR}: High bandwidth usage (>{$IF.UTIL.MAX:"{#IFNAME}"}%)'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'The network interface utilization is close to its estimated maximum bandwidth.'
              manual_close: 'YES'
              dependencies:
                - name: 'Interface {#IFDESCR}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))'
                  recovery_expression: 'last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                - tag: scope
                  value: performance
            - uuid: 9af274c414484d93a08a3f224ba87ef9
              expression: |
                min(/Pylon Peplink Switch Template/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
                or min(/Pylon Peplink Switch Template/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                max(/Pylon Peplink Switch Template/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
                and max(/Pylon Peplink Switch Template/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFDESCR}: High error rate'
              event_name: 'Interface {#IFDESCR}: High error rate (>{$IF.ERRORS.WARN:"{#IFNAME}"} for 5m)'
              opdata: 'errors in: {ITEM.LASTVALUE1}, errors out: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'Recovers when below 80% of {$IF.ERRORS.WARN:"{#IFNAME}"} threshold'
              manual_close: 'YES'
              dependencies:
                - name: 'Interface {#IFDESCR}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))'
                  recovery_expression: 'last(/Pylon Peplink Switch Template/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2 or {$IFCONTROL:"{#IFNAME}"}=0'
              tags:
                - tag: scope
                  value: performance
          graph_prototypes:
            - uuid: b4030044d41b48e7b56f3876d0721372
              name: 'Interface {#IFDESCR}: Network traffic'
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: 'Pylon Peplink Switch Template'
                    key: 'net.if.in[ifInOctets.{#SNMPINDEX}]'
                - sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 2774A4
                  item:
                    host: 'Pylon Peplink Switch Template'
                    key: 'net.if.out[ifOutOctets.{#SNMPINDEX}]'
                - sortorder: '2'
                  color: F63100
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink Switch Template'
                    key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
                - sortorder: '3'
                  color: A54F10
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink Switch Template'
                    key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
                - sortorder: '4'
                  color: FC6EA3
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink Switch Template'
                    key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
                - sortorder: '5'
                  color: 6C59DC
                  yaxisside: RIGHT
                  item:
                    host: 'Pylon Peplink Switch Template'
                    key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
      tags:
        - tag: IsUPS
          value: 'False'
      macros:
        - macro: '{$IF.ERRORS.WARN}'
          value: '2'
        - macro: '{$IF.UTIL.MAX}'
          value: '95'
        - macro: '{$IFCONTROL}'
          value: '1'
        - macro: '{$NET.IF.IFADMINSTATUS.MATCHES}'
          value: '^.*'
          description: 'Ignore notPresent(6)'
        - macro: '{$NET.IF.IFADMINSTATUS.NOT_MATCHES}'
          value: ^2$
          description: 'Ignore down(2) administrative status'
        - macro: '{$NET.IF.IFDESCR.MATCHES}'
          value: '.*'
        - macro: '{$NET.IF.IFDESCR.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
        - macro: '{$NET.IF.IFNAME.MATCHES}'
          value: '^.*$'
        - macro: '{$NET.IF.IFNAME.NOT_MATCHES}'
          value: '(^Software Loopback Interface|^NULL[0-9.]*$|^[Ll]o[0-9.]*$|^[Ss]ystem$|^Nu[0-9.]*$|^veth[0-9a-z]+$|docker[0-9]+|br-[a-z0-9]{12})'
          description: 'Filter out loopbacks, nulls, docker veth links and docker0 bridge by default'
        - macro: '{$NET.IF.IFOPERSTATUS.MATCHES}'
          value: '^.*$'
        - macro: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
          value: ^6$
          description: 'Ignore notPresent(6)'
        - macro: '{$NET.IF.IFTYPE.MATCHES}'
          value: '.*'
        - macro: '{$NET.IF.IFTYPE.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
        - macro: '{$SNMP.TIMEOUT}'
          value: 5m
      valuemaps:
        - uuid: da57e3e738bf42d589b39c47ba65b652
          name: 'IF-MIB::ifOperStatus'
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
            - value: '4'
              newvalue: unknown
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: notPresent
            - value: '7'
              newvalue: lowerLayerDown
        - uuid: e3ccd426f34e45229020d273cf773eef
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
  triggers:
    - uuid: 5f67106359b84943a0a6267bcec9b303
      expression: '(last(/Pylon Peplink Switch Template/system.hw.uptime[hrSystemUptime.0])>0 and last(/Pylon Peplink Switch Template/system.hw.uptime[hrSystemUptime.0])<10m) or (last(/Pylon Peplink Switch Template/system.hw.uptime[hrSystemUptime.0])=0 and last(/Pylon Peplink Switch Template/system.net.uptime[sysUpTime.0])<10m)'
      name: 'Switch has been restarted'
      event_name: '{HOST.NAME} has been restarted (uptime < 10m)'
      priority: WARNING
      description: 'Uptime is less than 10 minutes.'
      manual_close: 'YES'
      dependencies:
        - name: 'No SNMP data collection'
          expression: 'max(/Pylon Peplink Switch Template/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
      tags:
        - tag: scope
          value: notice
